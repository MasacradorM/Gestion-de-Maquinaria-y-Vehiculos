---
import '@/styles/main.scss';  // Ya incluye todos los estilos de configuraci√≥n

import Head from "@components/_head.astro";
import Footer from "@components/dashboard/_footer.astro";
import Topbar from "@components/dashboard/_topbar.astro";
import Sidenav from "@components/dashboard/_sidenav.astro";
import Scripts from "@components/_scripts.astro";

const title = "GM&V | Configuraci√≥n";
const path = "../../dist";
const mainPage = "configuracion";
const page = "index";

// Datos de ejemplo para la actividad reciente
const actividadReciente = [
  {
    id: 1,
    usuario: "Juan Perez",
    accion: "Nuevo usuario",
    descripcion: "a√±adido al sistema.",
    tipo: "usuario", // usuario, obra, personal
    timestamp: "Hace 2 horas"
  },
  {
    id: 2,
    usuario: "Nueva Obra",
    accion: "Plaza Comercial Las Palmas",
    descripcion: "registrada.",
    tipo: "obra",
    timestamp: "Hace 4 horas"
  },
  {
    id: 3,
    usuario: "Carlos Rodriguez",
    accion: "Nuevo conductor",
    descripcion: "a√±adido al sistema",
    tipo: "personal",
    timestamp: "Hace 6 horas"
  }
];

// Configuraci√≥n de tarjetas
const tarjetasConfig = [
  {
    id: 'usuarios',
    titulo: 'Usuarios',
    descripcion: 'Gesti√≥n de Usuarios y Permisos',
    icono: 'üë•',
    clase: 'config-card-usuarios'
  },
  {
    id: 'obras',
    titulo: 'Obras',
    descripcion: 'Gesti√≥n de Obras',
    icono: 'üöß',
    clase: 'config-card-obras'
  },
  {
    id: 'actividades',
    titulo: 'Actividades',
    descripcion: 'Gesti√≥n de actividades',
    icono: 'üìù',
    clase: 'config-card-actividades'
  },
  {
    id: 'personal',
    titulo: 'Personal',
    descripcion: 'Gesti√≥n de personal',
    icono: null, // Para la imagen personalizada
    clase: 'config-card-personal'
  }
];

const botonesAccesoRapido = [
  {
    icono: 'https://cdn-icons-png.flaticon.com/512/2661/2661440.png',
    texto: 'Nueva Obra',
    action: 'nueva-obra',
    modalId: 'modalNuevaObra' // Nueva propiedad
  },
  {
    icono: 'https://cdn-icons-png.flaticon.com/512/561/561184.png',
    texto: 'Nueva Actividad',
    action: 'nueva-actividad',
    modalId: 'modalNuevaActividad'
  },
  {
    icono: 'https://cdn-icons-png.flaticon.com/512/4175/4175032.png',
    texto: 'A√±adir Personal',
    action: 'a√±adir-personal',
    modalId: 'modalNuevoPersonal'
  }
];
// Datos de obras
const obras = [
  { id: 1, nombre: "Invias" },
  { id: 2, nombre: "Incont" },
  { id: 3, nombre: "Consorcio Montebello" },
  { id: 4, nombre: "V&M Ingenier√≠a sas v√≠as Colombia" },
  { id: 5, nombre: "Consorcio olivera Aipe" }
];
const  actividades = [
  { id: 1, nombreActividad: "Transporte de Vibro" },
  { id: 2, nombreActividad: "Excavaci√≥n" },
  { id: 3, nombreActividad: "Carga de Materiales" },
  { id: 4, nombreActividad: "Nivelaci√≥n de Terreno" },
  { id: 5, nombreActividad: "Otra actividad..." }
];
const  personal = [
  { id: 1, nombre: "Cristian Aldana", nDocumento: "123456789", tipo: "Operador" },
  { id: 2, nombre: "Aldair Diaz", nDocumento: "123456789", tipo: "Conductor" },
  { id: 3, nombre: "Cristian Aldana", nDocumento: "123456789", tipo: "Operador" },
  { id: 4, nombre: "Aldair Diaz", nDocumento: "123456789", tipo: "Conductor" },
  { id: 5, nombre: "Cristian Aldana", nDocumento: "123456789", tipo: "Operador" },
  { id: 6, nombre: "Aldair Diaz", nDocumento: "123456789", tipo: "Conductor" },
  { id: 7, nombre: "Cristian Aldana", nDocumento: "123456789", tipo: "Operador" },
  { id: 8, nombre: "Aldair Diaz", nDocumento: "123456789", tipo: "Conductor" },
  { id: 9, nombre: "Cristian Aldana", nDocumento: "123456789", tipo: "Operador" },
  { id: 10, nombre: "Aldair Diaz", nDocumento: "123456789", tipo: "Conductor" },
  { id: 11, nombre: "Cristian Aldana", nDocumento: "123456789", tipo: "Operador" },
  { id: 12, nombre: "Aldair Diaz", nDocumento: "123456789", tipo: "Conductor" },
  { id: 13, nombre: "Cristian Aldana", nDocumento: "123456789", tipo: "Operador" },
  { id: 14, nombre: "Aldair Diaz", nDocumento: "123456789", tipo: "Conductor" },  
];
---

<!doctype html>
<html lang="es">
  <head>
    <Head title={title} path={path} />
  </head>
  
  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
    <div class="app-wrapper">
      <Topbar path={path} />
      <Sidenav path={path} mainPage={mainPage} page={page} />
      
      <main class="app-main">
        <div class="app-content-header">
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-6">
        <h2 id="page-title" class="mb-0 config-title" style="font-size: 1.5rem;">Configuraci√≥n</h2>  
      </div>
      <div class="col-sm-6">
        <ol id="breadcrumb-nav" class="breadcrumb float-sm-end">
          <li class="breadcrumb-item"><a href="#">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">
            Configuraci√≥n
          </li>
        </ol>
      </div>
    </div>
  </div>
</div>

        <div class="app-content">
          <div class="container-fluid">
            
            <!-- Secci√≥n de Categor√≠as -->
            <div class="config-section">
              
              <div class="row g-4">
                {tarjetasConfig.map((tarjeta) => (
                  <div class="col-lg-3 col-md-6">
                    <div class={`config-card ${tarjeta.clase}`} data-config={tarjeta.id}>
                      <div class="config-card-icon">
                        {tarjeta.id === 'personal' ? (
                          <img 
                            class="casco" 
                            src="https://cdn-icons-png.freepik.com/512/17473/17473766.png?ga=GA1.1.84767501.1748519507" 
                            alt="Casco de seguridad"
                          />
                        ) : (
                          <span>{tarjeta.icono}</span>
                        )}
                      </div>
                      <div class="config-card-content">
                        <h4>{tarjeta.titulo}</h4>
                        <p>{tarjeta.descripcion}</p>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
 
            <!-- Actividad Reciente -->
            <div class="config-section">
              <h3 class="section-title">Actividad Reciente</h3>
              <div class="activity-container">
                {actividadReciente.map((item) => (
                  <div class={`activity-item activity-${item.tipo}`}>
                    <div class="activity-indicator"></div>
                    <div class="activity-content">
                      <div class="activity-header">
                        <span class="activity-user">{item.usuario}</span>
                        <span class="activity-timestamp">{item.timestamp}</span>
                      </div>
                      <div class="activity-description">
                        <strong>{item.accion}</strong> {item.descripcion}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <!-- Secci√≥n de Gesti√≥n de Obras -->
<div id="seccion-obras" class="gestion-section" style="display: none;">
  <!-- Controles superiores -->
   <div class="obras-controls">
  <div class="container-fluid">
    <div class="row justify-content-end"> 
      <div class="col-auto ms-auto"> 
        <div class="search-box-config">
          <div class="input-group-config">
            <input type="search" class="form-control-config" placeholder="Buscar Obras...">
            <span class="input-group-text">üîé</span>
          </div>
        </div>
      </div>
      <div class="col-auto"> <!-- Columna autom√°tica -->
        <button class="btn-nueva-obra" onclick="nuevaObra()">
          + Nueva Obra
        </button>
      </div>
    </div>
  </div>
</div>
  <!-- Tabla de obras (contenedor independiente) -->
  <div class="obras-table-wrapper">
    <div class="obras-table-container">
      <table class="obras-table">
        <thead>
          <tr>
            <th class="col-numero">#</th>
            <th class="col-obra">Obra</th>
            <th class="col-acciones">Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaObras">
          {obras.map((obra) => (
            <tr>
              <td class="numero">{obra.id}</td>
              <td class="nombre-obra">{obra.nombre}</td>
              
              <td class="acciones">
  <div class="acciones-container">
    <button class="btn-action btn-edit emoji" title="Editar">‚úèÔ∏è</button>
    <button class="btn-action btn-delete emoji" title="Eliminar">üóëÔ∏è</button>
  </div>
</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Controles inferiores (completamente fuera de la tabla) -->
  <div class="obras-bottom-controls">
    <div class="container-fluid">
      <div class="row align-items-center">
        <!-- Bot√≥n Volver a la izquierda -->
        <div class="col-md-2">
          <button class="btn-volver">
            <i class="fas fa-arrow-left"></i> Volver
          </button>
        </div>
        
        <!-- Paginaci√≥n centrada -->
        <div class="col-md-8 text-center">
          <div class="paginationConfig">
            <button onclick="cambiarPagina('prev')" id="prevBtn" class="page-btn">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="page-btn active" onclick="irAPagina(1)">1</button>
            <button class="page-btn" onclick="irAPagina(2)">2</button>
            <button class="page-btn" onclick="irAPagina(3)">3</button>
            <button class="page-btn" onclick="irAPagina(4)">4</button>
            <button class="page-btn" onclick="irAPagina(5)">5</button>
            <button onclick="cambiarPagina('next')" id="nextBtn" class="page-btn">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
        
        <!-- Espacio vac√≠o a la derecha -->
        <div class="col-md-2"></div>
      </div>
    </div>
  </div>
</div>


            <!-- Secci√≥n de Gesti√≥n de actividades -->
<div id="seccion-actividades" class="gestion-section" style="display: none;">

   <div class="obras-controls">
  <div class="container-fluid">
    <div class="row justify-content-end">
      <div class="col-auto ms-auto"> 
        <div class="search-box-config">
          <div class="input-group-config">
            <input type="search" class="form-control-config" placeholder="Buscar Actividades...">
            <span class="input-group-text">üîé</span>
          </div>
        </div>
      </div>
      <div class="col-auto"> 
        <button class="btn-nueva-actividad">
  + Nueva Actividad
        </button>
      </div>
    </div>
  </div>
</div>
  <!-- Tabla de obras (contenedor independiente) -->
  <div class="obras-table-wrapper">
    <div class="obras-table-container">
      <table class="obras-table">
        <thead>
          <tr>
            <th class="col-numero">#</th>
            <th class="col-obra">Actividad</th>
            <th class="col-acciones">Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaActividades">
  {actividades.map((actividad) => (
    <tr>
      <td class="numero">{actividad.id}</td>
      <td class="nombre-actividad">{actividad.nombreActividad}</td>
      <td class="acciones">
        <div class="acciones-container">
          <button class="btn-action btn-edit emoji" 
                  onclick="editarActividad(${actividad.id})">‚úèÔ∏è</button>
          <button class="btn-action btn-delete emoji"
                  onclick="eliminarActividad(${actividad.id})">üóëÔ∏è</button>
        </div>
      </td>
    </tr>
  ))}
</tbody>
      </table>
    </div>
  </div>
  
  <div class="obras-bottom-controls">
    <div class="container-fluid">
      <div class="row align-items-center">
        <!-- Bot√≥n Volver a la izquierda -->
        <div class="col-md-2">
          <button class="btn-volverActividad">
            <i class="fas fa-arrow-left"></i> Volver
          </button>
        </div>
        


        <!-- Paginaci√≥n centrada -->
        <div class="col-md-8 text-center">
          <div class="pagination">
            <button onclick="cambiarPagina('prev')" id="prevBtn" class="page-btn">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="page-btn active" onclick="irAPagina(1)">1</button>
            <button class="page-btn" onclick="irAPagina(2)">2</button>
            <button class="page-btn" onclick="irAPagina(3)">3</button>
            <button class="page-btn" onclick="irAPagina(4)">4</button>
            <button class="page-btn" onclick="irAPagina(5)">5</button>
            <button onclick="cambiarPagina('next')" id="nextBtn" class="page-btn">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
        
        <!-- Espacio vac√≠o a la derecha -->
        <div class="col-md-2"></div>
      </div>
    </div>
  </div>
</div>



            <!-- Secci√≥n de Gesti√≥n de personal -->
<div id="seccion-personal" class="gestion-section" style="display: none;">
  <!-- Controles superiores -->
   <div class="obras-controls">
  <div class="container-fluid">
    <div class="row justify-content-end"> <!-- Cambiado a justify-content-end -->
      <div class="col-auto ms-auto"> <!-- ms-auto empuja a la derecha -->
        <div class="search-box-config">
          <div class="input-group-config">
            <input type="search" class="form-control-config" placeholder="Buscar Personal...">
            <span class="input-group-text">üîé</span>
          </div>
        </div>
      </div>
      
      <div class="col-auto"> <!-- Columna autom√°tica -->
        <button class="btn-nueva-personal" >
          + Nuevo Personal
        </button>
      </div>
    </div>
  </div>
</div>

  <!-- Tabla de personal (contenedor independiente) -->
<div class="obras-table-wrapper">
    <div class="obras-table-container">
      <table class="obras-table">
        <thead>
          <tr>
            <th class="col-numero">#</th>
            <th class="col-nombre">Nombre Completo</th>
            <th class="col-nDocumento">No. Documento</th>
            <th class="col-tipo">Tipo de Personal</th>
            <th class="col-acciones">Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaPersonal">
          {personal.map((item) => (
            <tr>
              <td class="numero">{item.id}</td>
              <td class="nombre">{item.nombre}</td>
              <td class="nDocumento">{item.nDocumento}</td>
              <td class="tipo">{item.tipo}</td>
              <td class="acciones">
                <div class="acciones-container">
                  <button class="btn-action btn-edit emoji" title="Editar" onclick="editarPersonal(${item.id})">‚úèÔ∏è</button>
                  <button class="btn-action btn-delete emoji" title="Eliminar" onclick="eliminarPersonal(${item.id})">üóëÔ∏è</button>
                </div>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </div>  
  <!-- Controles inferiores (completamente fuera de la tabla) -->
  <div class="obras-bottom-controls">
    <div class="container-fluid">
      <div class="row align-items-center">
        <!-- Bot√≥n Volver a la izquierda -->
        <div class="col-md-2">
          <button class="btn-volverPersonal">
            <i class="fas fa-arrow-left"></i> Volver
          </button>
        </div>
        


        <!-- Paginaci√≥n centrada -->
        <div class="col-md-8 text-center">
          <div class="pagination">
            <button onclick="cambiarPagina('prev')" id="prevBtn" class="page-btn">
              <i class="fas fa-chevron-left"></i>
            </button>
            <button class="page-btn active" onclick="irAPagina(1)">1</button>
            <button class="page-btn" onclick="irAPagina(2)">2</button>
            <button class="page-btn" onclick="irAPagina(3)">3</button>
            <button class="page-btn" onclick="irAPagina(4)">4</button>
            <button class="page-btn" onclick="irAPagina(5)">5</button>
            <button onclick="cambiarPagina('next')" id="nextBtn" class="page-btn">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
        
        <!-- Espacio vac√≠o a la derecha -->
        <div class="col-md-2"></div>
      </div>
    </div>
  </div>
</div>


   <!-- Acceso R√°pido -->
  <div class="config-section">
  <h3 class="section-title" style="margin-bottom: 0.5rem; color: #1A365D !important;font-weight: bold !important;">Acceso R√°pido</h3>
  <div class="quick-access-container"> <!-- Nuevo contenedor -->
  {botonesAccesoRapido.map((boton) => (
  <button class="quick-access-btn" data-action={boton.action} data-modal-target={boton.modalId}>
    <img src={boton.icono} alt="icono" class="quick-access-icon"/>
    <span>{boton.texto}</span>
  </button>
))}
  </div>
</div>

          </div>
        </div>
      </main>
      
      <Footer />
    </div>
    
    <Scripts path={path} />
    

<!-- Modal Nueva Obra -->
<div id="modalNuevaObra" class="modal-commons-backdrop">
  <div class="modal-commons-container">
    <div class="modal-commons-header">
      <h2>Nueva Obra</h2>
    </div>
    <div class="modal-commons-body">
      <form id="formNuevaObra" class="form-config">
        <div class="form-config-group">
          <label for="nombreObra">Nombre de la Obra *</label>
          <input type="text" id="nombreObra" class="form-config-control" required>
        </div>
        <div class="modal-commons-footer">
          <button type="button" class="btn btn-secondary">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Nueva Actividad -->
<div id="modalNuevaActividad" class="modal-commons-backdrop">
  <div class="modal-commons-container">
    <div class="modal-commons-header">
      <h2>Nueva Actividad</h2>
    </div>
    <div class="modal-commons-body">
      <form id="formNuevaActividad" class="form-config">
        <div class="form-config-group">
          <label for="nombreActividad">Nombre de la Actividad *</label>
          <input type="text" id="nombreActividad" class="form-config-control" required>
        </div>
        <div class="modal-commons-footer">
          <button type="button" class="btn btn-secondary">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Nuevo Personal -->
<div id="modalNuevoPersonal" class="modal-commons-backdrop">
  <div class="modal-commons-container">
    <div class="modal-commons-header">
      <h2>Nuevo Personal</h2>
    </div>
    <div class="modal-commons-body">
      <form id="formNuevoPersonal" class="form-config">
        <div class="form-config-group">
          <label for="nombrePersonal">Nombre del Personal *</label>
          <input type="text" id="nombrePersonal" class="form-config-control" required>
        </div>
        <div class="form-config-group">
          <label for="documentoPersonal">No. Documento *</label>
          <input type="number" id="documentoPersonal" class="form-config-control" required>
        </div>
        <div class="form-config-group">
          <label for="tipoPersonal">Tipo de Personal *</label>  
          <select id="tipoPersonal" class="form-config-control" required>
            <option value="">Seleccione...</option>
            <option value="Operador">Operador</option>
            <option value="Conductor">Conductor</option>
          </select>
        </div>
        <div class="modal-commons-footer">
          <button type="button" class="btn btn-secondary">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="../scripts/configuracion.js"></script>

  </body>
</html>
