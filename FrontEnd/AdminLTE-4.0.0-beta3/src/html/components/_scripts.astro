---
const { path } = Astro.props;
const adminlteJsUrl = path + "/js/adminlte.js";
---

<!--begin::Third Party Plugin(OverlayScrollbars)-->
<script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js" integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ=" crossorigin="anonymous"></script>
<!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
<!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
<script src={adminlteJsUrl} is:inline></script>
<!--end::Required Plugin(AdminLTE)-->
<!--begin::OverlayScrollbars Configure-->
<script is:inline>
  const SELECTOR_SIDEBAR_WRAPPER = ".sidebar-wrapper";
  const Default = {
    scrollbarTheme: "os-theme-light",
    scrollbarAutoHide: "leave",
    scrollbarClickScroll: true,
  };
  document.addEventListener("DOMContentLoaded", function () {
    const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
    if (
      sidebarWrapper &&
      typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== "undefined"
    ) {
      OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
        scrollbars: {
          theme: Default.scrollbarTheme,
          autoHide: Default.scrollbarAutoHide,
          clickScroll: Default.scrollbarClickScroll,
        },
      });
    }
  });
</script>



<script>

// Espera a que el DOM esté cargado
document.addEventListener("DOMContentLoaded", () => {
  const estadoRadios = document.querySelectorAll<HTMLInputElement>('input[name="estado"]');
  const actividadCell = document.getElementById("actividad-cell")!;
  const hrInicial = document.getElementById("modal-hr-inicial") as HTMLInputElement;
  const hrFinal = document.getElementById("modal-hr-final") as HTMLInputElement;
  const hrTotal = document.getElementById("modal-horometro") as HTMLInputElement;
  const valorHr = document.getElementById("modal-valor-hr") as HTMLInputElement;
  const total = document.getElementById("modal-total") as HTMLInputElement;
  const galones = document.getElementById("combustible-galones") as HTMLInputElement;
  const hrCombustible = document.getElementById("combustible-horometro") as HTMLInputElement;
  const rendimiento = document.getElementById("combustible-rendimiento") as HTMLInputElement;

  // Mostrar u ocultar actividades según el estado
  estadoRadios.forEach((radio) => {
    radio.addEventListener("change", () => {
      actividadCell.style.display = (radio.id === "operacion" && radio.checked) ? "block" : "none";
    });
  });

  // Función para calcular horómetro total
  function calcularHorometroYTotal() {
    const inicial = parseFloat(hrInicial.value);
    const final = parseFloat(hrFinal.value);
    const valor = parseFloat(valorHr.value);

    if (!isNaN(inicial) && !isNaN(final) && final >= inicial) {
      const totalHoras = final - inicial;
      hrTotal.value = totalHoras.toFixed(2);

      if (!isNaN(valor)) {
        total.value = (totalHoras * valor).toFixed(2);
      }
    } else {
      hrTotal.value = "";
      total.value = "";
    }
  }

  // Función para calcular rendimiento
  function calcularRendimiento() {
    const gal = parseFloat(galones.value);
    const horas = parseFloat(hrCombustible.value);

    if (!isNaN(gal) && !isNaN(horas) && horas > 0) {
      rendimiento.value = (gal / horas).toFixed(2);
    } else {
      rendimiento.value = "";
    }
  }

  // Eventos para cálculo de horómetro y total
  hrInicial.addEventListener("input", calcularHorometroYTotal);
  hrFinal.addEventListener("input", calcularHorometroYTotal);
  valorHr.addEventListener("input", calcularHorometroYTotal);

  // Eventos para cálculo de rendimiento
  galones.addEventListener("input", calcularRendimiento);
  hrCombustible.addEventListener("input", calcularRendimiento);
});


const equipoModal = document.getElementById("equipoModal");

equipoModal?.addEventListener("show.bs.modal", (event) => {
  const button = event.relatedTarget as HTMLElement;

  const tipo = button.getAttribute("data-tipo") || "";
  const placa = button.getAttribute("data-placa") || "";
  const estado = button.getAttribute("data-estado") || "";
  const fecha = button.getAttribute("data-fecha") || "";
  const obra = button.getAttribute("data-obra") || "";
  const actividad = button.getAttribute("data-actividad") || "";
  const operador= button.getAttribute("data-operador") || "";

  // Colocar los valores en los campos del modal
  (document.getElementById("modal-tipo") as HTMLInputElement).value = tipo;
  (document.getElementById("modal-placa") as HTMLInputElement).value = placa;
  (document.getElementById("modal-fecha") as HTMLInputElement).value = fecha;
  (document.getElementById("modal-obra") as HTMLInputElement).value = obra;
  (document.getElementById("modal-actividad") as HTMLInputElement).value = actividad;
  (document.getElementById("modal-operador") as HTMLInputElement).value = operador;

  // Estado (radio button)
  const radio = document.querySelector(`input[name="estado"][value="${estado}"]`) as HTMLInputElement;
  if (radio) {
    radio.checked = true;
    radio.dispatchEvent(new Event("change")); // Para mostrar u ocultar "actividad"
  }
});


</script>

<!--end::OverlayScrollbars Configure-->
