---
import '../styles/maquina.scss'
import Head from "@components/_head.astro";
import Footer from "@components/dashboard/_footer.astro";
import Topbar from "@components/dashboard/_topbar.astro";
import Sidenav from "@components/dashboard/_sidenav.astro";
import Scripts from "@components/_scripts.astro";
import HistorialRegistro from "../../components/maquinaInterfaz/historialRegistro.astro";
const title = "Maquinaria Amarilla | Dashboard";
const path = "../../../dist";
const mainPage = "maquinaria";
const page = "listado";


// Función para obtener la clase CSS del estado
const getEstadoClass = (estado: string) => {
  // Primero normalizamos el estado (minúsculas, sin espacios extras)
  const estadoNormalizado = estado.trim().toLowerCase();
  

  return estados[estadoNormalizado] || estados['default'];
};


---

<!DOCTYPE html>
<html lang="es">
  <!--begin::Head-->
  <head>
     <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.css"
      integrity="sha256-4MX+61mt9NVvvuPjUWdUdyfZfxSB1/Rf9WtqRHgG5S0="
      crossorigin="anonymous"
    />

    <!-- Bootstrap CSS (esto probablemente ya lo tienes) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap Bundle JS (incluye Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <Head title={title} path={path} />
 
  </head>
  <!--end::Head-->
  <!--begin::Body-->
  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">

<!-- Modal Editar Maquina -->
<div class="modal fade" id="equipoModal" tabindex="-1" aria-labelledby="equipoModalLabel" aria-hidden="true">
<div class="modal-dialog modal-lg">
  <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="equipoModalLabel">Detalles del Equipo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Primera sección: Datos del equipo (siempre visible) -->
        <div class="row mb-3">
          <div class="col-md-4">
            <label for="modal-tipo" class="form-label">Tipo</label>
            <input type="text" class="form-control" id="modal-tipo" readonly>
          </div>
          <div class="col-md-4">
            <label for="modal-placa" class="form-label">Placa</label>
            <input type="text" class="form-control" id="modal-placa" readonly>
          </div>
        </div>
        <!-- Segunda sección: Estado del equipo (siempre visible) -->
        <div class="row mb-3">
          <div class="col-12">
            <label class="form-label">Estado del Equipo</label>
            <div class="estado-selector">
              <label class="estado-option">
                <input type="radio" name="estado" id="mantenimiento" value="EN MANTENIMIENTO">
                <span>EN MANTENIMIENTO</span>
              </label>
              <label class="estado-option">
                <input type="radio" name="estado" id="disponible" value="DISPONIBLE">
                <span>DISPONIBLE</span>
              </label>
              <label class="estado-option">
                <input type="radio" name="estado" id="operacion" value="EN OPERACION">
                <span>EN OPERACIÓN</span>
              </label>
              <label class="estado-option">
                <input type="radio" name="estado" id="standby" value="STAND BY">
                <span>STAND BY</span>
              </label>
            </div>
          </div>
        </div> 
        <hr>
          <div class="row mb-3">
            <div id="fecha-container" class="col-md-6" style="display: none;">
            <label for="modal-fecha" class="form-label">Fecha</label>
              <input type="date" class="form-control" id="modal-fecha">
            </div>
            <div id="obra-container" class="col-md-6" style="display: none;">
              <label for="modal-obra" class="form-label">Obra</label>
              <input type="text" class="form-control" id="modal-obra">
            </div>
          </div>
<div class="row mb-3">
  <!-- Contenedor independiente para operador -->
  <div id="operador-container" class="col-md-6" style="display: none;">
    <label for="modal-operador" class="form-label">Operador</label>
    <input type="text" class="form-control" id="modal-operador">
  </div>
  <!-- Contenedor independiente para reporte -->
  <div id="reporte-container" class="col-md-6" style="display: none;">
    <label for="modal-reporte" class="form-label">Reporte</label>
    <input type="text" class="form-control" id="modal-reporte">
  </div>
</div>
</div>
        <!-- Sección de horómetros (solo visible en EN OPERACIÓN) -->
        <div id="horas-section" class="mb-3">
          <h4>Horómetros</h4>
          <div class="row">
            <div class="col-md-4">
              <label for="modal-hr-inicial" class="form-label">Horómetro Inicial</label>
              <input type="number" class="form-control" id="modal-hr-inicial">
            </div>
            <div class="col-md-4">
              <label for="modal-hr-final" class="form-label">Horómetro Final</label>
              <input type="number" class="form-control" id="modal-hr-final">
            </div>
            <div class="col-md-4">
              <label for="modal-horometro" class="form-label">Horómetro Total</label>
              <input type="number" class="form-control" id="modal-horometro" readonly>
            </div>
          </div>
        </div>
        <!-- Sección de costos (solo visible en EN OPERACIÓN) -->
        <div id="costos-section" class="mb-3">
          <h4>Costos</h4>
          <div class="row">
            <div class="col-md-6">
              <label for="modal-valor-hr" class="form-label">Valor por hora</label>
              <input type="number" class="form-control" id="modal-valor-hr">
            </div>
            <div class="col-md-6">
              <label for="modal-total" class="form-label">Total</label>
              <input type="number" class="form-control" id="modal-total" readonly>
            </div>
          </div>
        </div>
        <!-- Sección de actividades (visible en EN OPERACIÓN y MANTENIMIENTO) -->
        <div id="actividad-cell" class="mb-4">
          <h4>Actividades</h4>
          <div class="d-flex gap-2 mb-2">
            <select id="actividad-select" class="form-select">
              <option value="" disabled selected>Seleccionar actividad</option>
              <option value="Transporte de Vibro">Transporte de Vibro</option>
              <option value="Excavación">Excavación</option>
              <option value="Carga de Materiales">Carga de Materiales</option>
              <option value="Nivelación de Terreno">Nivelación de Terreno</option>
              <option value="Otra actividad...">Otra actividad...</option>
            </select>
            
            <input type="number" id="cantidad-actividad" class="form-control" placeholder="cantidad" min="1">
            <button id="btn-agregar-actividad" type="button" class="btn btn-primary">
              Agregar
            </button>
          </div>
          <div id="nueva-actividad-container" class="mt-3 p-3 border rounded" style="display: none;">
            <label class="form-label" for="nueva-actividad-input">Nueva Actividad</label>
            <div class="d-flex gap-2">
              <input id="nueva-actividad-input" type="text" class="form-control" placeholder="Ingrese nueva actividad">
              <button id="btn-guardar-actividad" type="button" class="btn btn-success">
                Guardar
              </button>
            </div>
          </div>
          <div class="mt-3">
            <h5>Actividades agregadas:</h5>
            <div id="actividades-agregadas" class="mt-2">
              <p id="mensaje-actividades-vacio" class="text-muted fst-italic">No hay actividades agregadas.</p>
            </div>
          </div>
        </div>
<!-- Fuera del estado-selector, añade esto -->
<div id="programarMantenimiento-section" class="mt-3" style="display: none;">
  <div class="form-check">
    <input class="form-check-input" type="checkbox" id="programar-mantenimiento-check">
    <label class="form-check-label" for="programar-mantenimiento-check">
      Programar próximo mantenimiento
    </label>
  </div>
  
  <div id="mantenimiento-form" style="display: none;" class="mt-3 p-3 border bg-light">
    <label>Fecha próximo mantenimiento:</label>
    <input type="date" id="fecha-proximo-mantenimiento" class="form-control mb-2">
    <label>Mensaje:</label>
    <textarea id="mensaje-alerta" class="form-control mb-2"></textarea>
  </div>
</div>
  <!--Sección de GPS (solo visible en EN OPERACIÓN) -->
        <div class="row mb-3">
              <div  id ="gps-container" class="col-md-6" style="display: none;">  
              <label for="modal-gps" class="form-label">GPS</label>
              <input type="text" id="modal-gps" class="form-control">
            </div>
        </div>
        <!-- Sección de combustible (solo visible en EN OPERACIÓN) -->
        <div id="combustible-section" class="mb-4">
          <h4>Combustible</h4>
          <div class="row">
            <div class="col-md-4">
              <label for="combustible-galones" class="form-label">Galones</label>
              <input type="number" id="combustible-galones" class="form-control" step="0.01">
            </div>
            <div class="col-md-4">
              <label for="combustible-horometro" class="form-label">Horómetro</label>
              <input type="number" id="combustible-horometro" class="form-control">
            </div>
            <div class="col-md-4">
              <label for="combustible-rendimiento" class="form-label">Rendimiento (gal/hr)</label>
              <input type="text" id="combustible-rendimiento" class="form-control" readonly>
            </div>
          </div>
        </div>
        <!-- Sección de observaciones (visible en todos excepto DISPONIBLE) -->
        <div id="observaciones-section" class="mb-4">
          <h4>Observaciones</h4>
          <textarea id="modal-observaciones" class="form-control" rows="3" placeholder="Ingrese observaciones adicionales sobre el equipo o la operación"></textarea>
        </div>
      </div>
  
      <!-- Añade un modal-footer para los botones -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger">
          <i class="bi bi-trash"></i> Eliminar
        </button>
        <div class="d-flex gap-2 ms-auto">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-circle"></i> Cancelar
          </button>
          <button type="button" class="btn btn-primary">
            <i class="bi bi-save"></i> Guardar
          </button>
        </div>
      </div>
    </div> <!-- Cierre del modal-content -->
  </div> <!-- Cierre del modal-dialog -->
</div> <!-- Cierre del modal fade -->



   <!--begin::App Wrapper-->
    <div class="app-wrapper">
      <Topbar path={path} />
      <Sidenav path={path} mainPage={mainPage} page={page} />
      <!--begin::App Main-->
      <main class="app-main">
        <!--begin::App Content Header-->
        <div class="app-content-header">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <div class="col-sm-6">
                <h3 class="mb-0">Maquinaria Amarilla</h3>
              </div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="#">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">
                    Maquinaria Amarilla
                  </li>
                </ol>
              </div>
            </div>
            <!--end::Row-->
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content Header-->
        <!--begin::App Content-->
        <div class="app-content">
          <!--begin::Container-->
          <div class="container-fluid">
         <div class="filtros">
  <div class="search-box">
    <div class="input-group">
      <input type="search" class="form-control" placeholder="Buscar..." aria-label="Buscar">
      <span class="input-group-text">
        <img src="https://abs-0.twimg.com/emoji/v2/svg/1f50d.svg" alt="buscar" style="width:1em; height:1em;">
      </span>
    </div>
  </div>

  <!-- Contenedor de filtros responsive -->
  <div class="filtros-dropdown d-flex flex-md-row flex-column flex-wrap gap-2 align-items-start align-items-md-center">
    <!-- Filtro Estado -->
    <div class="dropdown">
      <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
        Estado : Todos
      </button>
    </div>
    
    <!-- Filtro Operador -->
    <div class="dropdown">
      <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
        Operador: Todos
      </button>
    </div>

    <!-- Botón Reporte Diario (ahora en btn-light) -->
    <button class="btn btn-light mt-2 mt-md-0" data-bs-toggle="modal" data-bs-target="#modalNuevaMaquina">
       <strong>+ Nueva Maquina</strong>
    </button>
  </div>
</div>            


<!-- Modal -->
<div class="modal fade" id="modalNuevaMaquina" tabindex="-1" aria-labelledby="modalNuevaMaquinaLabel">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalNuevaMaquinaLabel">Registrar Nueva Máquina</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <form id="formNuevaMaquina">
        <div class="modal-body">
          <!-- Tipo de máquina -->
<div class="mb-3">
  <label for="tipo" class="form-label">Tipo de máquina</label>
  <select class="form-select" id="tipo" name="tipo" required>
    <option value="">Seleccione...</option>
    <option value="autohormigonera">Autohormigonera</option>
    <option value="motoniveladora">Motoniveladora</option>
    <option value="excavadora">Excavadora</option>
    <option value="retrocargador">Retrocargador</option>
    <option value="mini_excavadora">Mini excavadora</option>
    <option value="minicargador">Minicargador</option>
    <option value="vibrocompactador">Vibrocompactador</option>
    <option value="otro">Otro...</option>
  </select>
</div>
<!-- Campo adicional para nuevo tipo -->
<div class="mb-3" id="nuevoTipoContainer" style="display: none;">
  <label for="nuevoTipo" class="form-label">Nuevo tipo de máquina</label>
  <input type="text" class="form-control" id="nuevoTipo" name="nuevoTipo" placeholder="Escriba el nuevo tipo">
</div>
          <div class="mb-3">
            <label for="placa" class="form-label">Placa</label>
            <input type="text" class="form-control" id="placa" name="placa" placeholder="Ej: SDN095" required>
          </div>

  <div class="mb-3">
  <label for="operador" class="form-label">Asignar a (Operador)</label>
  <select class="form-select" id="operador" name="operador">
    <option value="">-- Sin asignar --</option>
    <option value="Cristian Aldana">Cristian Aldana</option>
    <option value="Aldair Diaz">Aldair Diaz</option>
  </select>
</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar Máquina</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 1. AGREGA ESTE HTML ANTES DEL CIERRE </body> EN TU PÁGINA -->
<div id="historialOverlay" style="display: none;">
  <button onclick="cerrarHistorial()" class="btn btn-danger" style="position: absolute; top: 1rem; right: 1rem; z-index: 40; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
    Cerrar
  </button>
  
  <h2 style="padding: 2rem 2rem 1rem 2rem; margin: 0; color: #0d2b55; font-weight: 600;">
    Historial de Registros
  </h2>
  
  <div class="table-container">
    <table id="tablaHistorial">
  <thead>
        <tr>
          <th class="sticky-first-col sticky-header">Fecha</th>
          <th class="sticky-second-col sticky-header">Placa</th>
          <th>Obra</th>
          <th style="min-width: 200px;">Actividad</th>
          <th>Hora Inicial</th>
          <th>Hora Final</th>
          <th>Total Horas</th>
          <th>Valor Hora</th>
          <th>Galones</th>
          <th>Valor Galones</th>
          <th>Horometro Tanqueo</th>
          <th>GPS</th>
          <th>Observaciones</th>
          <th>Reporte</th>
           <th>Operador</th>
        </tr>
      </thead>
  <tbody>
    <!-- Las filas generadas dinámicamente deben tener: -->
    <tr>
      <td class="sticky-first-col">...</td>
      <td class="sticky-second-col">...</td>
      <!-- resto de celdas normales -->
    </tr>
  </tbody>
</table>
  </div>
</div>

<!--begin::Row-->
            <div class="row" 
id="maquinas-container">

              <!-- Asegúrate que existe este contenedor -->
  <!-- Las tarjetas aparecerán aquí -->


            </div>
            <!--end::Row-->
            
            <!-- Paginación -->
            <nav aria-label="Paginación de maquinaria">
              <ul class="pagination justify-content-center">
                <li class="page-item">
                  <a class="page-link" href="#" aria-label="Anterior">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>
                <li class="page-item active">
                  <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">2</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">3</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">4</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">5</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#" aria-label="Siguiente">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
          <!--end::Container-->
        </div>
        <!--end::App Content-->
      </main>
      <!--end::App Main-->
      <Footer />
    </div>

    <!--end::App Wrapper-->
    <!--begin::Script-->
    <Scripts path={path} />
     </body><!--end::Body-->
  
</html>