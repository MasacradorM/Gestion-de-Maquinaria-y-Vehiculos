---
import Head from "@components/_head.astro";
import Footer from "@components/dashboard/_footer.astro";
import Topbar from "@components/dashboard/_topbar.astro";
import Sidenav from "@components/dashboard/_sidenav.astro";
import Scripts from "@components/_scripts.astro";
import RendimientoComparativoChart from "@components/dashboard/_rendimientoComparativo.astro";
import EstadoVehiculos from "@components/dashboard/_estadoVehiculos.astro";
import RegistroResumen from "@components/dashboard/_registroResumen.astro";
import AlertasPendientes from "@components/dashboard/_alertasPendientes.astro";

// Datos para los componentes - Idealmente esto vendr√≠a de API/BD
const vehiculosData = {
  total: 26,
  disponibles: 26,
  mantenimiento: 4,
  transito: 10,
  combustible: 2,
  rendimientoPromedio: 12
};

const tendencias = {
  total: "+2%",
  mantenimiento: "+2%",
  combustible: "+8%",
  rendimiento: "+2%"
};

const vehiculos = [
  { nombre: "CAMION DAJ441", base: "MALIBU" },
  { nombre: "CAMION DAJ441", base: "MALIBU" },
  { nombre: "CAMION DAJ441", base: "MALIBU" },
];

const vehiculosPendientes = [
  { codigo: "DA3450", nombre: "CAMI√ìN DA3450" },
  { codigo: "SVF404", nombre: "VOLQUETA SVF404" },
  { codigo: "DA3445", nombre: "CAMI√ìN DA3445" },
  { codigo: "DA3445", nombre: "CAMI√ìN DA3445" }
];

const alertas = [
  {
    tipo: 'urgente',
    mensaje: 'Mantenimiento Urgente',
    detalle: 'CAMION DA3435 - Programar hoy para revisi√≥n'
  },
  {
    tipo: 'advertencia',
    mensaje: 'Combustible Bajo',
    detalle: 'Volqueta SVF404 - 15% restante, programar repostaje'
  },
  {
    tipo: 'informacion',
    mensaje: 'Eficiencia Mejorada',
    detalle: 'Hoy la flota consumi√≥ 8% menos combustible que ayer'
  }
];

const rendimientoData = {
  datosAyer: {
    kmRecorridos: 90,
    rendimientoKmGal: 25,
    galonesUsados: 23,
    velocidadMax: 22
  },
  datosAnteayer: {
    kmRecorridos: 50,
    rendimientoKmGal: 0,
    galonesUsados: 0, 
    velocidadMax: 0
  },
  fechaAyer: "08/04/2025",
  fechaAnteayer: "09/04/2025"
};

// Configuraci√≥n de la p√°gina
const title = "Control de Flota | Dashboard";
const path = "../../dist";
const mainPage = "dashboard";
const page = "index";
---

<!doctype html>
<html lang="es">
  <head>
    <Head title={title} path={path} />

    <!-- Recursos externos - CDN -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.css"
      integrity="sha256-4MX+61mt9NVvvuPjUWdUdyfZfxSB1/Rf9WtqRHgG5S0="
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/jsvectormap@1.5.3/dist/css/jsvectormap.min.css"
      integrity="sha256-+uGLJmmTKOqBr+2E6KDYs/NRsHxSkONXFHUL0fy2O/4="
      crossorigin="anonymous"
    />
  </head>
  <body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
    <div class="app-wrapper">
      <!-- Componentes de navegaci√≥n -->
      <Topbar path={path} />
      <Sidenav path={path} mainPage={mainPage} page={page} />
      
      <!-- Contenido principal -->
      <main class="app-main">
        <!-- Encabezado -->
        <div class="app-content-header">
          <div class="container-fluid">
            <div class="row align-items-center">
              <div class="col-sm-6">
                <h1 class="page-title mb-0">Control de flota</h1>
                <p class="page-subtitle text-muted">Monitoreo y an√°lisis de veh√≠culos</p>
              </div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="breadcrumb-item"><a href="#">Home</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
                </ol>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Indicadores clave -->
        <div class="app-content">
          <div class="container-fluid">
            <div class="row">
              <!-- Widget 1: Total veh√≠culos -->
              <div class="col-xl-3 col-lg-6 col-md-6 col-12 mb-4">
                <div class="dashboard-card">
                  <div class="dashboard-card-icon bg-primary-subtle">
                    <span class="emoji-icon">üöö</span>
                  </div>
                  <div class="dashboard-card-content">
                    <h3 class="dashboard-card-value">{vehiculosData.total}</h3>
                    <p class="dashboard-card-label">Veh√≠culos Totales</p>
                    <span class="dashboard-card-trend">{tendencias.total} m√°s que ayer</span>
                  </div>
                </div>
              </div>

              <!-- Widget 2: Mantenimiento -->
              <div class="col-xl-3 col-lg-6 col-md-6 col-12 mb-4">
                <div class="dashboard-card">
                  <div class="dashboard-card-icon bg-warning-subtle">
                    <span class="emoji-icon">üîß</span>
                  </div>
                  <div class="dashboard-card-content">
                    <h3 class="dashboard-card-value">{vehiculosData.mantenimiento}</h3>
                    <p class="dashboard-card-label">En Mantenimiento</p>
                    <span class="dashboard-card-trend">{tendencias.mantenimiento} m√°s que ayer</span>
                  </div>
                </div>
              </div>

              <!-- Widget 3: Combustible -->
              <div class="col-xl-3 col-lg-6 col-md-6 col-12 mb-4">
                <div class="dashboard-card">
                  <div class="dashboard-card-icon bg-danger-subtle">
                    <span class="emoji-icon">‚õΩ</span>
                  </div>
                  <div class="dashboard-card-content">
                    <h3 class="dashboard-card-value">{vehiculosData.combustible}</h3>
                    <p class="dashboard-card-label">Combustible</p>
                    <span class="dashboard-card-trend">{tendencias.combustible} m√°s que ayer</span>
                  </div>
                </div>
              </div>

              <!-- Widget 4: Rendimiento -->
              <div class="col-xl-3 col-lg-6 col-md-6 col-12 mb-4">
                <div class="dashboard-card">
                  <div class="dashboard-card-icon bg-success-subtle">
                    <span class="emoji-icon">üìä</span>
                  </div>
                  <div class="dashboard-card-content">
                    <h3 class="dashboard-card-value">{vehiculosData.rendimientoPromedio}</h3>
                    <p class="dashboard-card-label">Rendimiento Promedio</p>
                    <span class="dashboard-card-trend">{tendencias.rendimiento} m√°s que ayer</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Gr√°ficos y estados -->
            <div class="row">
              <!-- Gr√°fico de rendimiento -->
              <div class="col-lg-6 mb-4">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="card-title">Rendimiento Comparativo</h5>
                  </div>
                  <div class="card-body">
                    <RendimientoComparativoChart 
                      datosAyer={rendimientoData.datosAyer}
                      datosAnteayer={rendimientoData.datosAnteayer}
                      fechaAyer={rendimientoData.fechaAyer}
                      fechaAnteayer={rendimientoData.fechaAnteayer}
                    />
                  </div>
                </div>
              </div>

              <!-- Estado de veh√≠culos -->
              <div class="col-lg-6 mb-4">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="card-title">Estado de la Flota</h5>
                  </div>
                  <div class="card-body">
                    <EstadoVehiculos
                      disponibles={vehiculosData.disponibles}
                      mantenimiento={vehiculosData.mantenimiento}
                      transito={vehiculosData.transito}
                      vehiculos={vehiculos}
                      client:load
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- Registros y Alertas -->
            <div class="row">
              <!-- Registro Resumen -->
              <div class="col-lg-6 mb-4">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="card-title">Registro Diario</h5>
                  </div>
                  <div class="card-body">
                    <RegistroResumen 
                      horaInicio="7:05 AM"
                      totalVehiculos={vehiculosData.total}
                      vehiculosPendientes={vehiculosPendientes}
                      porcentajeCompletado={85}
                    />
                  </div>
                </div>
              </div>

              <!-- Alertas Pendientes -->
              <div class="col-lg-6 mb-4">
                <div class="card h-100">
                  <div class="card-header">
                    <h5 class="card-title">Alertas Pendientes</h5>
                  </div>
                  <div class="card-body">
                    <AlertasPendientes alertas={alertas} />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      
      <!-- Pie de p√°gina -->
      <Footer />
    </div>

    <!-- Scripts -->
    <Scripts path={path} />
    
    <style>
      /* Estilos generales */
      :root {
        --primary-color: rgba(26, 54, 93, 1);
        --primary-light: rgba(26, 54, 93, 0.1);
        --success-color: #2cae68;
        --warning-color: #fbc02d;
        --danger-color: #f44336;
        --info-color: #546e7a;
        --border-radius: 1rem;
        --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }
      
      .page-title {
        font-family: Verdana, sans-serif;
        font-weight: bold;
        color: var(--primary-color);
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
      }
      
      .page-subtitle {
        color: #666;
        font-size: 0.9rem;
        margin-top: 0;
      }
      
      /* Tarjetas de indicadores */
      .dashboard-card {
        position: relative;
        border-radius: var(--border-radius);
        padding: 1.25rem;
        background: white;
        box-shadow: var(--card-shadow);
        height: 100%;
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      
      .dashboard-card-icon {
        flex-shrink: 0;
        border-radius: 0.75rem;
        padding: 0.75rem;
        display: grid;
        place-items: center;
        width: 60px;
        height: 60px;
      }
      
      .emoji-icon {
        font-size: 2rem;
        line-height: 1;
      }
      
      .dashboard-card-content {
        flex: 1;
      }
      
      .dashboard-card-value {
        font-size: 1.75rem;
        margin: 0;
        line-height: 1.2;
        font-weight: bold;
      }
      
      .dashboard-card-label {
        margin: 0.15rem 0;
        color: #666;
        font-size: 0.85rem;
      }
      
      .dashboard-card-trend {
        color: var(--success-color);
        font-size: 0.8rem;
        display: inline-block;
      }
      
      /* Colores para fondos de iconos */
      .bg-primary-subtle { background-color: rgba(75, 169, 233, 0.1); }
      .bg-success-subtle { background-color: rgba(44, 174, 104, 0.1); }
      .bg-warning-subtle { background-color: rgba(251, 192, 45, 0.1); }
      .bg-danger-subtle { background-color: rgba(244, 67, 54, 0.1); }
      
      /* Tarjetas para componentes */
      .card {
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        border: none;
      }
      
      .card-header {
        background-color: white;
        border-bottom: 1px solid #f0f0f0;
        padding: 1rem 1.25rem;
        border-top-left-radius: var(--border-radius);
        border-top-right-radius: var(--border-radius);
      }
      
      .card-title {
        margin: 0;
        font-weight: 600;
        color: var(--primary-color);
        font-size: 1.1rem;
      }
      
      .card-body {
        padding: 1.25rem;
      }
      
      /* Adaptabilidad */
      @media (max-width: 768px) {
        .dashboard-card-icon {
          width: 50px;
          height: 50px;
          padding: 0.5rem;
        }
        
        .emoji-icon {
          font-size: 1.75rem;
        }
        
        .dashboard-card-value {
          font-size: 1.5rem;
        }
      }
    </style>
  </body>
</html>